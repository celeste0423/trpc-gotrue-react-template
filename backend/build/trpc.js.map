{"version":3,"sources":["../src/trpc.ts"],"sourcesContent":["import { initTRPC, TRPCError } from '@trpc/server'\r\n\r\nimport { Context } from './context'\r\n\r\n// You can use any variable name you like.\r\n// We use t to keep things simple.\r\n//t로 trpc 컨텍스트 생성, 서버 생성에 필요한 다양한 정보들을 넣을 컨텍스트\r\n//t = 트랜스포머\r\nconst t = initTRPC.context<Context>().create()\r\n\r\n//라우터, 미들웨어, 프로시저 설정(trpc에서 핵심적으로 사용되는 것들)\r\n\r\n//router : 여러가지 관려 procedures를 묶어주는 역할을 함\r\nexport const router = t.router\r\nexport const mergeRouters = t.mergeRouters\r\n//middleware: 요청과 응답 사이에서 동작하는 소프트웨어 컴포넌트(보안, 로깅, 세션관리, 인증, 이미지 변환)\r\nexport const middleware = t.middleware\r\n\r\nexport const publicProcedure = t.procedure\r\n\r\nexport const userProcedure = t.procedure.use(\r\n\tt.middleware(({ next, ctx }) => {\r\n\t\t//컨텍스트에서 jwt와 userAuthClient받아오기\r\n\t\tconst { jwt, userAuthClient } = ctx\r\n\r\n\t\t//jwt또는 userAuthClient가 없으면 Unauthorized 에러 송출\r\n\t\tif (!jwt || !userAuthClient) {\r\n\t\t\tthrow new TRPCError({\r\n\t\t\t\tcode: 'UNAUTHORIZED',\r\n\t\t\t})\r\n\t\t}\r\n\t\t//next는 다음 미들웨어를 호출하기 위한 함수()\r\n\t\treturn next({\r\n\t\t\tctx: {\r\n\t\t\t\tjwt,\r\n\t\t\t\tuserAuthClient,\r\n\t\t\t},\r\n\t\t})\r\n\t}),\r\n)\r\n"],"names":["mergeRouters","middleware","publicProcedure","router","userProcedure","t","initTRPC","context","create","procedure","use","next","ctx","jwt","userAuthClient","TRPCError","code"],"mappings":";;;;;;;;;;;IAcaA,YAAY;eAAZA;;IAEAC,UAAU;eAAVA;;IAEAC,eAAe;eAAfA;;IALAC,MAAM;eAANA;;IAOAC,aAAa;eAAbA;;;wBApBuB;AAIpC,0CAA0C;AAC1C,kCAAkC;AAClC,8CAA8C;AAC9C,WAAW;AACX,MAAMC,IAAIC,gBAAQ,CAACC,OAAO,GAAYC,MAAM;AAKrC,MAAML,SAASE,EAAEF,MAAM;AACvB,MAAMH,eAAeK,EAAEL,YAAY;AAEnC,MAAMC,aAAaI,EAAEJ,UAAU;AAE/B,MAAMC,kBAAkBG,EAAEI,SAAS;AAEnC,MAAML,gBAAgBC,EAAEI,SAAS,CAACC,GAAG,CAC3CL,EAAEJ,UAAU,CAAC,CAAC,EAAEU,IAAI,EAAEC,GAAG,EAAE;IAC1B,gCAAgC;IAChC,MAAM,EAAEC,GAAG,EAAEC,cAAc,EAAE,GAAGF;IAEhC,8CAA8C;IAC9C,IAAI,CAACC,OAAO,CAACC,gBAAgB;QAC5B,MAAM,IAAIC,iBAAS,CAAC;YACnBC,MAAM;QACP;IACD;IACA,6BAA6B;IAC7B,OAAOL,KAAK;QACXC,KAAK;YACJC;YACAC;QACD;IACD;AACD"}