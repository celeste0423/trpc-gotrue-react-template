{"version":3,"sources":["../src/auth.ts"],"sourcesContent":["import { GoTrueClient, SupportedStorage } from '@supabase/gotrue-js'\r\nimport fetch from 'cross-fetch'\r\nconst { GOTRUE_URL, GOTRUE_JWT_SECRET } = process.env\r\n\r\nconst inMemoryStorageFactory = (): SupportedStorage => {\r\n\tlet data: Record<string, string> = {}\r\n\treturn {\r\n\t\tgetItem: key => data[key] ?? null,\r\n\t\tremoveItem: key => {\r\n\t\t\tdata = Object.fromEntries(Object.entries(data).filter(([k]) => k !== key))\r\n\t\t},\r\n\t\tsetItem: (key, value) => {\r\n\t\t\tdata = {\r\n\t\t\t\t...data,\r\n\t\t\t\t[key]: value,\r\n\t\t\t}\r\n\t\t},\r\n\t}\r\n}\r\n\r\nexport const userAuthClient = new GoTrueClient({\r\n\turl: GOTRUE_URL,\r\n\tfetch,\r\n\tautoRefreshToken: true,\r\n\tpersistSession: true,\r\n\tstorage: inMemoryStorageFactory(),\r\n})\r\n\r\nexport const createUserAuthClient = (accessToken?: string) =>\r\n\tnew GoTrueClient({\r\n\t\turl: GOTRUE_URL,\r\n\t\tfetch,\r\n\t\tautoRefreshToken: true,\r\n\t\tpersistSession: true,\r\n\t\tstorage: inMemoryStorageFactory(),\r\n\t\theaders: {\r\n\t\t\t//Bearer => 헤더의 인증 scheme을 식별하여 그 뒤에 오는 토큰은 사용자 인증용이라는 걸 인식\r\n\t\t\t//주로 OAuth 2.0 등에서 자주 사용\r\n\t\t\tAuthorization: `Bearer ${accessToken}`,\r\n\t\t},\r\n\t})\r\n"],"names":["createUserAuthClient","userAuthClient","GOTRUE_URL","GOTRUE_JWT_SECRET","process","env","inMemoryStorageFactory","data","getItem","key","removeItem","Object","fromEntries","entries","filter","k","setItem","value","GoTrueClient","url","fetch","autoRefreshToken","persistSession","storage","accessToken","headers","Authorization"],"mappings":";;;;;;;;;;;IA4BaA,oBAAoB;eAApBA;;IARAC,cAAc;eAAdA;;;0BApBkC;mEAC7B;;;;;;AAClB,MAAM,EAAEC,UAAU,EAAEC,iBAAiB,EAAE,GAAGC,QAAQC,GAAG;AAErD,MAAMC,yBAAyB;IAC9B,IAAIC,OAA+B,CAAC;IACpC,OAAO;QACNC,SAASC,CAAAA,MAAOF,IAAI,CAACE,IAAI,IAAI;QAC7BC,YAAYD,CAAAA;YACXF,OAAOI,OAAOC,WAAW,CAACD,OAAOE,OAAO,CAACN,MAAMO,MAAM,CAAC,CAAC,CAACC,EAAE,GAAKA,MAAMN;QACtE;QACAO,SAAS,CAACP,KAAKQ;YACdV,OAAO;gBACN,GAAGA,IAAI;gBACP,CAACE,IAAI,EAAEQ;YACR;QACD;IACD;AACD;AAEO,MAAMhB,iBAAiB,IAAIiB,sBAAY,CAAC;IAC9CC,KAAKjB;IACLkB,OAAAA,mBAAK;IACLC,kBAAkB;IAClBC,gBAAgB;IAChBC,SAASjB;AACV;AAEO,MAAMN,uBAAuB,CAACwB,cACpC,IAAIN,sBAAY,CAAC;QAChBC,KAAKjB;QACLkB,OAAAA,mBAAK;QACLC,kBAAkB;QAClBC,gBAAgB;QAChBC,SAASjB;QACTmB,SAAS;YACR,2DAA2D;YAC3D,wBAAwB;YACxBC,eAAe,CAAC,OAAO,EAAEF,YAAY,CAAC;QACvC;IACD"}